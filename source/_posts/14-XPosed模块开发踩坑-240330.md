---
title: XPosedæ¨¡å—å¼€å‘è¸©å‘
category: Android
date: 2024-03-30 18:00:00
index_img: https://devsjournal.com/wp-content/uploads/2015/12/Download-Xposed-Framework-and-Installer-for-Android.jpg
---

![img](https://devsjournal.com/wp-content/uploads/2015/12/Download-Xposed-Framework-and-Installer-for-Android.jpg)
(å›¾æº[Download Xposed Framework and Installer](https://devsjournal.com/download-install-xposed-installer-framework-android.html))

# tl;dr
ä¸ºäº†åœ¨æ¯•è®¾é‡ŒåŠ å…¥è¯­éŸ³æ§åˆ¶ï¼Œè®¡åˆ’å¯¹ç³»ç»Ÿè¯­éŸ³åŠ©æ‰‹è¿›è¡ŒåŠ¨æ€æ³¨å…¥ä»¥å®ç°è¯­éŸ³æ§åˆ¶ï¼ŒæŠ€æœ¯é€‰å‹ä¸º`XPosed`ã€‚~~*è°å®¶è‡ªåŠ¨åŒ–æ¯•è®¾ä»£ç è¦æ³¨å…¥åˆ«çš„è¿›ç¨‹å•ŠğŸ¤£ğŸ‘‰*~~


# XPosedæ¨¡å—å¼€å‘ç¯å¢ƒæ­å»º
æœ¬æ–‡é€‰ç”¨çš„æ˜¯åŸºäº[`EzXHelper`](https://github.com/KyuubiRan/EzXHelper) + [`DexKit`](https://github.com/LuckyPray/DexKit)çš„å¼€å‘ç¯å¢ƒã€‚

ä¸€åˆ‡çš„é¦–å…ˆï¼šAndroid studioåˆ›å»ºå·¥ç¨‹ã€‚
åœ¨`build.gradle.kts(app)`ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š
``` kotlin
// EzX Helper  
implementation("com.github.kyuubiran:EzXHelper:1.0.3")  
compileOnly("de.robv.android.xposed:api:82")  
  
// Dex Kit  
implementation("org.luckypray:dexkit:2.0.0")
```

åœ¨`settings.gradle.kts`ä¸­çš„`dependencyResolutionManagement`æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªä»“åº“ï¼š
``` kotlin
maven(url = "https://jitpack.io")  
maven(url = "https://api.xposed.info")
```

åœ¨`AndroidManifest.xml`ä¸­çš„`application`èŠ‚ç‚¹ä¸­æ·»åŠ ä»¥ä¸‹é”®å€¼ä»¥èƒ½åœ¨`LSPosed`ä¸­æ˜¾ç¤ºæ¨¡å—ä¿¡æ¯ï¼š
``` xml
<meta-data  
    android:name="xposedmodule"  
    android:value="true" />  
<meta-data  
    android:name="xposeddescription"  
    android:value="@string/xposeddescription" />  <!--è¿™æ˜¯åœ¨æ¨¡å—åç§°ä¸‹é¢çš„å°å­—-->
<meta-data  
    android:name="xposedminversion"  
    android:value="93" />  
<meta-data  
    android:name="xposedscope"  
    android:resource="@array/xposed_scope" /><!--ä½œç”¨åŸŸ-->
```

å…¶ä¸­ä½œç”¨åŸŸçš„xmlæ–‡ä»¶è¿™ä¹ˆå¡«(ä¸€è¡Œä¸€ä¸ªåŒ…å)ï¼š
``` xml
<?xml version="1.0" encoding="utf-8"?>  
<resources>  
    <string-array name="xposed_scope">  
       <item>com.android.launcher3</item>  
    </string-array>
</resources>
```

åˆ›å»ºxposedçš„ä¸»hookç±»(æˆ‘åˆ›å»ºåœ¨`com.example.package`ä¸‹ï¼Œå«`HookEntry.kt`)ï¼š
``` kotlin
class HookEntry : IXposedHookLoadPackage, IXposedHookZygoteInit {  
  
    override fun initZygote(startupParam: IXposedHookZygoteInit.StartupParam) {  
       EzXHelperInit.initZygote(startupParam)  
    }  
  
    override fun handleLoadPackage(lpparam: XC_LoadPackage.LoadPackageParam) {  
       val packageName: String = lpparam.packageName  
       EzXHelperInit.initHandleLoadPackage(lpparam)  
  
       when (packageName) {  
          // ä¿®æ”¹æ¨¡å—æ¿€æ´»çŠ¶æ€, è¿™é‡Œéœ€è¦ä½ çš„MainActivityä¸‹æœ‰ä¸€ä¸ªå«isActiveçš„å‡½æ•°, å¹¶ä¸”æ˜¯è°ƒç”¨å°±ç›´æ¥è¿”å›falseçš„ã€‚åœ¨æ¿€æ´»æ¨¡å—åï¼Œä¸‹é¢çš„hookä»£ç ä¼šè®©å®ƒè¿”å›trueä»¥å®ç°è®©å®ƒçŸ¥é“æ¨¡å—æ¿€æ´»äº†ã€‚
          BuildConfig.APPLICATION_ID -> {  
             findMethod("com.example.package.MainActivity") {  
                name == "isActive" && returnType == Boolean::class.java  
             }.hookBefore {  
                it.result = true  
             }  
          }  
          "target.package.name" -> {/* your hook code here */ }  
       }  
    }  
}
```

ç„¶ååˆ›å»º`assets`æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åˆ›å»º`xposed_init`æ–‡ä»¶ï¼Œå†™å…¥ä¸Šé¢é‚£ä¸ªç±»æ–‡ä»¶çš„åŒ…å:
``` text
com.example.package.HookEntry
```
> è¿™é‡Œä¸éœ€è¦ç®¡æ‰©å±•åï¼Œä¸ç”¨åƒåœ¨`java`é‡Œè°ƒç”¨`kotlin`éœ€è¦å†™`HookEntryKt.xxx`ä¸€æ ·



# æç¤º`duplicated class`æ€ä¹ˆåŠ
åœ¨`gradle.properties`é‡Œç¡®ä¿æ·»åŠ äº†ä»¥ä¸‹ä¸¤è¡Œï¼š
``` prop
android.useAndroidX=true
android.enableJetifier=true
```


# `LSPosed`æç¤ºå…³é—­`éƒ¨ç½²ä¼˜åŒ–`ï¼Œæ€ä¹ˆæ“ä½œ
Android studioå·¦ä¸Šè§’ä¸‰æ¨ª - `Run` - `Edit Configurations...` - å–æ¶ˆå‹¾é€‰`Always install with package manager`ï¼Œä¿å­˜ï¼