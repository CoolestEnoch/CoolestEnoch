---
title: iSH的浅折腾记录
category: Linux
date: 2024-01-14 18:00:00
index_img: https://ish.app/assets/icon.png
---

![封面](https://ish.app/assets/icon.png)

闲来没事折腾折腾苹果上的ish，这东西比Termux难用：比如清华的一键换源命令不能用，默认给的是root用户，用的还是x86的包。

本质上还是相当于折腾Alpine Linux

# 从0开始装到能用ssh
~~***第0步当然是去AppStore里下载iSH***~~

换清华源还是可以换的，只不过不能用官方的换源命令了，得改一下：
``` bash
sed -i 's/apk.ish.app\/v3.14-2023-05-19/mirrors.tuna.tsinghua.edu.cn\/alpine\/v3.14/g' /etc/apk/repositories
```

至于清华的换源命令为什么不能用....我们来看一下`/etc/apk/repositories`文件里是啥:
```bash
# This file contains pinned repositories managed by iSH. If the /ish directory
# exists, iSH uses the metadata stored in it to keep this file up to date (by
# overwriting the contents on boot.)
http://apk.ish.app/v3.14-2023-05-19/main
http://apk.ish.app/v3.14-2023-05-19/community
```
清华的换源脚本会找不到匹配的字符串，所以得把更换的地方给调整一下。把`repositories`文件变成这样就行：
```bash
# This file contains pinned repositories managed by iSH. If the /ish directory
# exists, iSH uses the metadata stored in it to keep this file up to date (by
# overwriting the contents on boot.)
http://mirrors.tuna.tsinghua.edu.cn/alpine/v3.14/main
http://mirrors.tuna.tsinghua.edu.cn/alpine/v3.14/community
```


添加用户：
```bash
apk add sudo
adduser username
addgroup username wheel
```
到这里用户就建完了，给他加到wheel用户组里以可以执行sudo命令：
```bash
visudo
# 找到%wheel ALL=(ALL) NOPASSWD: ALL前面的#，删掉他然后保存退出
```

开整openssh：
``` bash
apk add openssh openssh-server
ssh-keygen -A
```


# SSH，启动！
```
/usr/sbin/sshd
```
注意`iSH`中必须用绝对路径启动`sshd`，否则会报错说`sshd re-exec requires execution with an absolute path`
这个时候将你的公钥传到`/home/username/.ssh/authorized_keys`中，就可以连上了！
``` bash
PS C:\Users\admin> ssh admin@192.168.1.102
Enter passphrase for key 'C:\Users\admin/.ssh/id_rsa':
Welcome to Alpine!

You can install packages with: apk add <package>

You may change this message by editing /etc/motd.

iPad:~$ pwd
/home/admin
iPad:~$ neofetch
       .hddddddddddddddddddddddh.          admin@iPad
      :dddddddddddddddddddddddddd:         ---------------
     /dddddddddddddddddddddddddddd/        OS: Alpine Linux v3.14 i686
    +dddddddddddddddddddddddddddddd+       Kernel: 4.20.69-ish
  `sdddddddddddddddddddddddddddddddds`     Uptime: 15 mins
 `ydddddddddddd++hdddddddddddddddddddy`    Packages: 32 (apk)
.hddddddddddd+`  `+ddddh:-sdddddddddddh.   Shell: ash
hdddddddddd+`      `+y:    .sddddddddddh   Terminal: /dev/pts/1
ddddddddh+`   `//`   `.`     -sddddddddd   CPU: (2)
ddddddh+`   `/hddh/`   `:s-    -sddddddd   Memory: 1808MiB / 2036MiB
ddddh+`   `/+/dddddh/`   `+s-    -sddddd
ddd+`   `/o` :dddddddh/`   `oy-    .yddd
hdddyo+ohddyosdddddddddho+oydddy++ohdddh
.hddddddddddddddddddddddddddddddddddddh.
 `yddddddddddddddddddddddddddddddddddy`
  `sdddddddddddddddddddddddddddddddds`
    +dddddddddddddddddddddddddddddd+
     /dddddddddddddddddddddddddddd/
      :dddddddddddddddddddddddddd:
       .hddddddddddddddddddddddh.

iPad:~$
```


# 安装OMZ
这就跟别的电脑上安装步骤一样了没啥区别。
```bash
sudo apk add git zsh
git clone --depth=1 https://github.com/ohmyzsh/ohmyzsh.git
cd ohmyzsh
cd tools
sh install.sh
```